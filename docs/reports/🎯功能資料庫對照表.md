# ğŸ¯ TanaPOS v4 åŠŸèƒ½èˆ‡è³‡æ–™åº«å°ç…§è¡¨

**ç‰ˆæœ¬**: v4.0  
**æ—¥æœŸ**: 2025-08-05  
**æè¿°**: è©³ç´°åˆ—å‡ºæ¯å€‹åŠŸèƒ½é é¢æ‰€éœ€çš„è³‡æ–™åº«è³‡æº

---

## ğŸ“‹ åŠŸèƒ½é é¢è³‡æ–™éœ€æ±‚å°ç…§

### 1. ğŸ½ï¸ é»é¤ç³»çµ± (OrderingPage.tsx)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… å•†å“åˆ†é¡ç€è¦½
- âœ… å•†å“å±•ç¤ºèˆ‡ç¯©é¸
- âœ… è³¼ç‰©è»Šç®¡ç†
- âœ… å¥—é¤é¸æ“‡
- âœ… æ¡Œå°é¸æ“‡
- âœ… è¨‚å–®æäº¤

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `categories` | åˆ†é¡åˆ—è¡¨é¡¯ç¤º | `id`, `name`, `icon`, `color`, `sort_order` | é«˜ |
| `products` | å•†å“å±•ç¤º | `id`, `name`, `price`, `description`, `image_url`, `is_available` | é«˜ |
| `product_variants` | å•†å“è¦æ ¼é¸æ“‡ | `id`, `product_id`, `name`, `price_adjustment` | ä¸­ |
| `product_modifiers` | åŠ æ–™é¸é … | `id`, `product_id`, `name`, `price`, `type` | ä¸­ |
| `combo_products` | å¥—é¤åˆ—è¡¨ | `id`, `name`, `price`, `description`, `combo_type` | ä¸­ |
| `combo_selection_rules` | å¥—é¤è¦å‰‡ | `id`, `combo_id`, `selection_name`, `min_selections`, `max_selections` | ä¸­ |
| `combo_selection_options` | å¥—é¤é¸é … | `id`, `rule_id`, `product_id`, `additional_price` | ä¸­ |
| `tables` | æ¡Œå°é¸æ“‡ | `id`, `table_number`, `name`, `status`, `capacity` | ä½ |

#### API æŸ¥è©¢éœ€æ±‚
```sql
-- è¼‰å…¥åˆ†é¡
SELECT id, name, icon, color, sort_order 
FROM categories 
WHERE restaurant_id = ? AND is_active = true 
ORDER BY sort_order;

-- è¼‰å…¥å•†å“ï¼ˆå«åˆ†é¡ç¯©é¸ï¼‰
SELECT p.*, c.name as category_name 
FROM products p 
LEFT JOIN categories c ON p.category_id = c.id 
WHERE p.restaurant_id = ? AND p.is_available = true 
AND (? IS NULL OR p.category_id = ?)
ORDER BY p.sort_order;

-- è¼‰å…¥å¥—é¤èˆ‡è¦å‰‡
SELECT cp.*, csr.*, cso.* 
FROM combo_products cp 
LEFT JOIN combo_selection_rules csr ON cp.id = csr.combo_id 
LEFT JOIN combo_selection_options cso ON csr.id = cso.rule_id 
WHERE cp.is_available = true;
```

---

### 2. ğŸ“‹ è¨‚å–®ç®¡ç† (OrdersPage.tsx)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… è¨‚å–®åˆ—è¡¨é¡¯ç¤º
- âœ… è¨‚å–®ç‹€æ…‹ç¯©é¸
- âœ… è¨‚å–®è©³æƒ…æŸ¥çœ‹
- âœ… è¨‚å–®ç‹€æ…‹æ›´æ–°
- âœ… æ™‚é–“ç¯„åœç¯©é¸

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `orders` | è¨‚å–®ä¸»è³‡æ–™ | `id`, `order_number`, `table_number`, `status`, `total_amount`, `created_at` | é«˜ |
| `order_items` | è¨‚å–®é …ç›® | `id`, `order_id`, `product_name`, `quantity`, `unit_price`, `status` | é«˜ |
| `tables` | æ¡Œå°è³‡è¨Š | `id`, `table_number`, `name` | ä¸­ |
| `products` | å•†å“è©³æƒ… | `id`, `name`, `image_url` | ä¸­ |
| `payments` | ä»˜æ¬¾ç‹€æ…‹ | `id`, `order_id`, `status`, `amount` | ä½ |

#### API æŸ¥è©¢éœ€æ±‚
```sql
-- è¨‚å–®åˆ—è¡¨ï¼ˆå«ç¯©é¸ï¼‰
SELECT o.*, t.table_number, t.name as table_name,
       COUNT(oi.id) as item_count,
       SUM(oi.quantity) as total_quantity
FROM orders o 
LEFT JOIN tables t ON o.table_id = t.id 
LEFT JOIN order_items oi ON o.id = oi.order_id 
WHERE o.restaurant_id = ? 
AND (? IS NULL OR o.status = ?)
AND (? IS NULL OR DATE(o.created_at) >= ?)
GROUP BY o.id 
ORDER BY o.created_at DESC;

-- è¨‚å–®è©³æƒ…
SELECT oi.*, p.image_url 
FROM order_items oi 
LEFT JOIN products p ON oi.product_id = p.id 
WHERE oi.order_id = ?;
```

---

### 3. ğŸª‘ æ¡Œå°ç®¡ç† (TableManagementPage.tsx)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… æ¡Œå°ç‹€æ…‹ç¸½è¦½
- âœ… æ¡Œå°ç‹€æ…‹åˆ‡æ›
- âœ… æ¡Œå°é ç´„ç®¡ç†
- âœ… æ¸…æ½”èˆ‡ç¶­è­·ç‹€æ…‹
- âœ… æ¡Œå°ä½¿ç”¨æœƒè©±

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `tables` | æ¡Œå°ä¸»è³‡æ–™ | `id`, `table_number`, `status`, `capacity`, `current_session_id` | é«˜ |
| `table_sessions` | ä½¿ç”¨æœƒè©± | `id`, `table_id`, `customer_name`, `party_size`, `seated_at` | é«˜ |
| `table_reservations` | é ç´„è³‡æ–™ | `id`, `table_id`, `customer_name`, `reservation_time`, `status` | ä¸­ |
| `orders` | ç›¸é—œè¨‚å–® | `id`, `table_id`, `order_number`, `status`, `total_amount` | ä¸­ |
| `order_items` | è¨‚å–®é …ç›® | `id`, `order_id`, `product_name`, `quantity` | ä½ |

#### API æŸ¥è©¢éœ€æ±‚
```sql
-- æ¡Œå°ç¸½è¦½
SELECT t.*, ts.customer_name, ts.party_size, ts.seated_at,
       o.order_number, o.total_amount, o.status as order_status
FROM tables t 
LEFT JOIN table_sessions ts ON t.current_session_id = ts.id 
LEFT JOIN orders o ON t.id = o.table_id AND o.status IN ('pending', 'confirmed', 'preparing')
WHERE t.restaurant_id = ? AND t.is_active = true;

-- æ¡Œå°é ç´„
SELECT * FROM table_reservations 
WHERE table_id = ? AND reservation_time >= CURRENT_DATE 
ORDER BY reservation_time;
```

---

### 4. ğŸ’³ çµå¸³ç³»çµ± (CheckoutPage.tsx)

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… é¸æ“‡çµå¸³æ¡Œå°
- âœ… æŸ¥çœ‹è¨‚å–®æ˜ç´°
- âœ… ä»˜æ¬¾æ–¹å¼é¸æ“‡
- âœ… é‡‘é¡è¨ˆç®—
- âœ… æ”¶æ“šç”Ÿæˆ

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `orders` | å¾…çµå¸³è¨‚å–® | `id`, `order_number`, `table_id`, `subtotal`, `total_amount`, `status` | é«˜ |
| `order_items` | è¨‚å–®æ˜ç´° | `id`, `order_id`, `product_name`, `quantity`, `unit_price`, `total_price` | é«˜ |
| `tables` | æ¡Œå°è³‡è¨Š | `id`, `table_number`, `name`, `status` | ä¸­ |
| `payments` | ä»˜æ¬¾è¨˜éŒ„ | `id`, `order_id`, `payment_method`, `amount`, `status` | ä¸­ |
| `receipts` | æ”¶æ“šè¨˜éŒ„ | `id`, `order_id`, `receipt_number`, `total_amount` | ä½ |

#### API æŸ¥è©¢éœ€æ±‚
```sql
-- å¾…çµå¸³æ¡Œå°
SELECT t.*, o.id as order_id, o.order_number, o.total_amount 
FROM tables t 
JOIN orders o ON t.id = o.table_id 
WHERE o.status IN ('served', 'ready') AND o.payment_status = 'unpaid';

-- çµå¸³æ˜ç´°
SELECT oi.product_name, oi.quantity, oi.unit_price, oi.total_price 
FROM order_items oi 
WHERE oi.order_id = ?;
```

---

### 5. ğŸ“‚ èœå–®ç®¡ç†ç³»çµ±

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… åˆ†é¡ç®¡ç† (CRUD)
- âœ… å•†å“ç®¡ç† (CRUD)
- âœ… å¥—é¤ç®¡ç† (CRUD)
- âœ… æ‰¹é‡æ“ä½œ
- âœ… æ’åºèˆ‡æœå°‹

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `categories` | åˆ†é¡ç®¡ç† | æ‰€æœ‰æ¬„ä½ | é«˜ |
| `products` | å•†å“ç®¡ç† | æ‰€æœ‰æ¬„ä½ | é«˜ |
| `product_variants` | å•†å“è®Šé«” | æ‰€æœ‰æ¬„ä½ | ä¸­ |
| `product_modifiers` | å•†å“åŠ æ–™ | æ‰€æœ‰æ¬„ä½ | ä¸­ |
| `combo_products` | å¥—é¤ç®¡ç† | æ‰€æœ‰æ¬„ä½ | ä¸­ |
| `combo_selection_rules` | å¥—é¤è¦å‰‡ | æ‰€æœ‰æ¬„ä½ | ä¸­ |
| `combo_selection_options` | å¥—é¤é¸é … | æ‰€æœ‰æ¬„ä½ | ä¸­ |

---

### 6. ğŸ³ KDS å»šæˆ¿é¡¯ç¤ºç³»çµ±

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… å¾…è£½ä½œé …ç›®é¡¯ç¤º
- âœ… è£½ä½œç‹€æ…‹æ›´æ–°
- âœ… æ™‚é–“ç®¡ç†
- âœ… å“è³ªæª¢æŸ¥
- âœ… å®Œæˆé€šçŸ¥

#### è³‡æ–™è¡¨éœ€æ±‚

| è³‡æ–™è¡¨ | ç”¨é€” | é—œéµæ¬„ä½ | æŸ¥è©¢é »ç‡ |
|--------|------|----------|----------|
| `orders` | è¨‚å–®ç‹€æ…‹ | `id`, `order_number`, `table_number`, `status`, `created_at` | é«˜ |
| `order_items` | è£½ä½œé …ç›® | `id`, `product_name`, `quantity`, `status`, `special_instructions` | é«˜ |
| `products` | è£½ä½œæ™‚é–“ | `id`, `prep_time_minutes`, `kitchen_station` | ä¸­ |
| `tables` | æ¡Œå°è³‡è¨Š | `id`, `table_number` | ä½ |

#### API æŸ¥è©¢éœ€æ±‚
```sql
-- KDS å¾…è£½ä½œé …ç›®
SELECT o.order_number, o.table_number, oi.product_name, oi.quantity, 
       oi.status, oi.special_instructions, p.prep_time_minutes,
       oi.created_at, oi.preparation_started_at
FROM order_items oi 
JOIN orders o ON oi.order_id = o.id 
LEFT JOIN products p ON oi.product_id = p.id 
WHERE oi.status IN ('confirmed', 'preparing') 
ORDER BY oi.created_at;
```

---

## ğŸ”„ è³‡æ–™åŒæ­¥éœ€æ±‚

### å³æ™‚æ›´æ–°éœ€æ±‚

| åŠŸèƒ½ | è§¸ç™¼äº‹ä»¶ | å½±éŸ¿é é¢ | åŒæ­¥è³‡æ–™ |
|------|----------|----------|----------|
| æ–°è¨‚å–® | è¨‚å–®æäº¤ | KDS, è¨‚å–®ç®¡ç†, æ¡Œå°ç®¡ç† | `orders`, `order_items`, `tables` |
| ç‹€æ…‹æ›´æ–° | KDS æ“ä½œ | è¨‚å–®ç®¡ç†, æ¡Œå°ç®¡ç† | `order_items.status` |
| æ¡Œå°ç‹€æ…‹ | æ¡Œå°æ“ä½œ | æ¡Œå°ç®¡ç†, é»é¤ç³»çµ± | `tables.status` |
| çµå¸³å®Œæˆ | ä»˜æ¬¾è™•ç† | æ¡Œå°ç®¡ç†, è¨‚å–®ç®¡ç† | `orders`, `payments`, `tables` |

### Supabase Realtime è¨­å®š
```sql
-- å•Ÿç”¨å³æ™‚è¨‚é–±çš„è³‡æ–™è¡¨
ALTER PUBLICATION supabase_realtime ADD TABLE orders;
ALTER PUBLICATION supabase_realtime ADD TABLE order_items;
ALTER PUBLICATION supabase_realtime ADD TABLE tables;
```

---

## ğŸ“Š æ•ˆèƒ½å„ªåŒ–å»ºè­°

### 1. æŸ¥è©¢å„ªåŒ–
```sql
-- é»é¤ç³»çµ±å¸¸ç”¨æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_products_category_available 
ON products(category_id, is_available, sort_order);

-- è¨‚å–®ç®¡ç†æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_orders_restaurant_status_date 
ON orders(restaurant_id, status, created_at DESC);

-- KDS ç³»çµ±æŸ¥è©¢å„ªåŒ–
CREATE INDEX idx_order_items_status_created 
ON order_items(status, created_at);
```

### 2. å¿«å–ç­–ç•¥
- **åˆ†é¡èˆ‡å•†å“**: å¿«å– 1 å°æ™‚ï¼Œç•°å‹•æ™‚æ¸…é™¤
- **æ¡Œå°ç‹€æ…‹**: å¿«å– 5 åˆ†é˜
- **è¨‚å–®åˆ—è¡¨**: ä¸å¿«å–ï¼Œä½¿ç”¨å³æ™‚æŸ¥è©¢

### 3. åˆ†é æŸ¥è©¢
```sql
-- è¨‚å–®åˆ†é æŸ¥è©¢
SELECT * FROM orders 
WHERE restaurant_id = ? 
ORDER BY created_at DESC 
LIMIT ? OFFSET ?;
```

---

## ğŸš¨ æ³¨æ„äº‹é …

### 1. è³‡æ–™ä¸€è‡´æ€§
- è¨‚å–®ç‹€æ…‹æ›´æ–°éœ€è¦äº‹å‹™è™•ç†
- æ¡Œå°ç‹€æ…‹è®Šæ›´éœ€è¦é©—è­‰
- åº«å­˜æ‰£æ¸›éœ€è¦æ¨‚è§€é–å®š

### 2. ä½µç™¼è™•ç†
- åŒæ™‚é»é¤çš„ç«¶æ…‹æ¢ä»¶
- æ¡Œå°ç‹€æ…‹è¡çªè™•ç†
- ä»˜æ¬¾é‡è¤‡æäº¤é˜²è­·

### 3. è³‡æ–™é©—è­‰
- è¨‚å–®é‡‘é¡è¨ˆç®—é©—è­‰
- æ¡Œå°å®¹é‡é™åˆ¶æª¢æŸ¥
- å•†å“å¯ç”¨æ€§æª¢æŸ¥

---

## ğŸ“ˆ æ“´å±•è¦åŠƒ

### çŸ­æœŸæ“´å±• (1-3 å€‹æœˆ)
- [ ] æœƒå“¡ç³»çµ±æ•´åˆ
- [ ] å„ªæƒ åˆ¸åŠŸèƒ½
- [ ] å¤–é€ç³»çµ±
- [ ] è¡Œå‹•æ”¯ä»˜

### ä¸­æœŸæ“´å±• (3-6 å€‹æœˆ)
- [ ] å¤šåº—ç®¡ç†
- [ ] ä¾›æ‡‰éˆç®¡ç†
- [ ] è²¡å‹™å ±è¡¨
- [ ] CRM ç³»çµ±

### é•·æœŸæ“´å±• (6-12 å€‹æœˆ)
- [ ] AI æ¨è–¦å¼•æ“
- [ ] é æ¸¬åˆ†æ
- [ ] è‡ªå‹•æ’ç¨‹
- [ ] IoT è¨­å‚™æ•´åˆ

---

*æ­¤å°ç…§è¡¨ç¢ºä¿æ¯å€‹åŠŸèƒ½é é¢éƒ½æœ‰å®Œæ•´çš„è³‡æ–™æ”¯æ´ï¼Œä¸¦é ç•™æœªä¾†æ“´å±•ç©ºé–“ã€‚*
