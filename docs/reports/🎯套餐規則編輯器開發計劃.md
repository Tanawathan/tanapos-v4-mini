# 🎯 套餐規則編輯器開發計劃

## 📋 專案概要
- **開發階段**: Phase 4 進階功能
- **執行日期**: 2025年8月6日
- **目標**: 完整的套餐規則編輯與預覽系統

## 🎯 開發重點任務

### 1. 套餐規則編輯器 (進行中)
- **自選套餐的商品選項配置**
- **加價設定功能**

### 2. 套餐預覽功能
- **完整套餐內容展示**
- **價格計算預覽**

---

## 📊 技術架構設計

### 1. 資料結構擴展

#### 1.1 套餐規則 (combo_selection_rules)
```sql
-- 套餐選擇規則表
combo_selection_rules:
  - id: string (Primary Key)
  - combo_id: string (Foreign Key → combo_products.id)
  - rule_name: string (規則名稱，如"主餐選擇")
  - min_selections: integer (最少選擇數量)
  - max_selections: integer (最多選擇數量)
  - is_required: boolean (是否必選)
  - sort_order: integer (排序)
```

#### 1.2 套餐選項 (combo_selection_options)
```sql
-- 套餐選項表
combo_selection_options:
  - id: string (Primary Key)
  - rule_id: string (Foreign Key → combo_selection_rules.id)
  - product_id: string (Foreign Key → products.id)
  - additional_price: decimal (加價金額)
  - is_default: boolean (是否為預設選項)
  - is_available: boolean (是否可選)
```

### 2. 組件架構

```
ComboManagement
├── ComboCard
├── ComboModal
└── ComboRuleEditor (新增)
    ├── RuleSection
    ├── OptionSelector
    └── PriceCalculator
└── ComboPreview (新增)
    ├── PreviewCard
    ├── PriceBreakdown
    └── ConfigurationSummary
```

---

## 🛠️ 實作計劃

### Phase 1: 套餐規則編輯器基礎 (預計 4 小時)

#### 1.1 ComboRuleEditor 組件 ✅
- [ ] 建立 ComboRuleEditor.tsx
- [ ] 規則群組管理界面
- [ ] 商品選項配置界面
- [ ] 加價設定功能

#### 1.2 RuleSection 子組件 ✅
- [ ] 規則基本設定 (名稱、必選、數量限制)
- [ ] 排序與刪除功能
- [ ] 驗證邏輯

#### 1.3 OptionSelector 子組件 ✅
- [ ] 商品選擇器
- [ ] 加價設定輸入
- [ ] 預設選項標記
- [ ] 可用性切換

### Phase 2: 套餐預覽功能 (預計 3 小時)

#### 2.1 ComboPreview 組件 ✅
- [ ] 建立 ComboPreview.tsx
- [ ] 套餐內容完整展示
- [ ] 即時價格計算
- [ ] 配置摘要顯示

#### 2.2 PriceCalculator 工具 ✅
- [ ] 價格計算邏輯
- [ ] 加價項目統計
- [ ] 價格範圍顯示 (最低-最高價)

#### 2.3 PreviewCard 展示組件 ✅
- [ ] 套餐卡片預覽
- [ ] 選項組展示
- [ ] 價格明細分解

### Phase 3: 系統整合與測試 (預計 2 小時)

#### 3.1 API 服務擴展 ✅
- [ ] 套餐規則 CRUD API
- [ ] 套餐選項 CRUD API
- [ ] 批量操作 API

#### 3.2 狀態管理更新 ✅
- [ ] menuStore 擴展規則管理
- [ ] 規則驗證邏輯
- [ ] 錯誤處理機制

#### 3.3 整合測試 ✅
- [ ] 套餐建立完整流程測試
- [ ] 規則編輯功能測試
- [ ] 預覽功能驗證
- [ ] 點餐系統整合測試

---

## 🎨 UI/UX 設計規範

### 1. 規則編輯器設計

#### 1.1 規則區塊佈局
```
┌─────────────────────────────────────────────┐
│ 🍜 主餐選擇                    [編輯] [刪除] │
├─────────────────────────────────────────────┤
│ ☑ 必選  最少: [1] 個  最多: [1] 個         │
├─────────────────────────────────────────────┤
│ 可選商品:                                   │
│ ☑ 牛肉拉麵 (+$0)           [預設] [移除]   │
│ ☑ 豚骨拉麵 (+$20)                 [移除]   │
│ ☑ 海鮮拉麵 (+$50)                 [移除]   │
│ [+ 新增商品選項]                           │
└─────────────────────────────────────────────┘
```

#### 1.2 預覽區塊設計
```
┌─────────────────────────────────────────────┐
│ 🔍 套餐預覽                                │
├─────────────────────────────────────────────┤
│ 套餐名稱: 經典商務套餐                      │
│ 基礎價格: $200                             │
├─────────────────────────────────────────────┤
│ 配置選項:                                   │
│ • 主餐選擇 (必選1個)                       │
│   - 牛肉拉麵 (+$0)                        │
│   - 豚骨拉麵 (+$20)                       │
│   - 海鮮拉麵 (+$50)                       │
│                                             │
│ • 飲品選擇 (必選1個)                       │
│   - 紅茶 (+$0)                            │
│   - 咖啡 (+$30)                           │
├─────────────────────────────────────────────┤
│ 價格範圍: $200 - $280                      │
└─────────────────────────────────────────────┘
```

### 2. 色彩與圖示系統

#### 2.1 規則類型色彩
- **必選規則**: 🔴 red-500 (#ef4444)
- **可選規則**: 🟡 yellow-500 (#eab308)
- **附加規則**: 🔵 blue-500 (#3b82f6)

#### 2.2 狀態指示圖示
- **編輯中**: ✏️ Edit
- **已完成**: ✅ CheckCircle
- **有錯誤**: ❌ XCircle
- **預覽模式**: 🔍 Eye

---

## 📝 開發檢查清單

### ✅ Phase 1: 規則編輯器
- [ ] `ComboRuleEditor.tsx` 組件建立
- [ ] `RuleSection.tsx` 規則區塊組件
- [ ] `OptionSelector.tsx` 選項選擇器
- [ ] 規則 CRUD 功能實現
- [ ] 商品選項管理功能
- [ ] 加價設定與驗證
- [ ] 拖拽排序功能

### ✅ Phase 2: 預覽系統
- [ ] `ComboPreview.tsx` 預覽組件
- [ ] `PriceCalculator.ts` 價格計算邏輯
- [ ] `PreviewCard.tsx` 預覽卡片
- [ ] 即時價格更新
- [ ] 配置摘要顯示
- [ ] 價格範圍計算

### ✅ Phase 3: 整合測試
- [ ] API 服務層擴展
- [ ] menuStore 狀態管理更新
- [ ] 錯誤處理與驗證
- [ ] 單元測試撰寫
- [ ] 整合測試執行
- [ ] 使用者接受測試

---

## 🚀 執行時程

| 階段 | 預計時間 | 完成標準 |
|------|----------|----------|
| Phase 1 | 4 小時 | 規則編輯器完整功能 |
| Phase 2 | 3 小時 | 預覽系統正常運作 |
| Phase 3 | 2 小時 | 整合測試全部通過 |
| **總計** | **9 小時** | **生產環境就緒** |

---

## 🎯 成功標準

### 1. 功能完整性
- ✅ 支援固定套餐與自選套餐
- ✅ 規則編輯器直觀易用
- ✅ 預覽功能準確反映實際配置
- ✅ 價格計算正確無誤

### 2. 使用者體驗
- ✅ 操作流程順暢
- ✅ 即時回饋與驗證
- ✅ 錯誤提示清楚明確
- ✅ 響應式設計支援

### 3. 技術品質
- ✅ TypeScript 類型安全
- ✅ 組件可重用性高
- ✅ 效能優化良好
- ✅ 測試覆蓋率達標

---

## 📚 相關文件

- [📂菜單管理Phase4完成報告.md](./📂菜單管理Phase4完成報告.md)
- [📋菜單管理頁面設計報告.md](./📋菜單管理頁面設計報告.md)
- [🍳KDS廚房顯示系統完成報告.md](./🍳KDS廚房顯示系統完成報告.md)

---

**開始執行時間**: 2025年8月6日  
**預計完成時間**: 2025年8月6日  
**執行狀態**: 🚀 準備開始
