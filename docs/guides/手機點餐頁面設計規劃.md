# 📱 TanaPOS 手機點餐頁面設計規劃

## 🎯 設計目標
- **服務員專用**：針對服務員快速下單需求設計
- **手機優化**：適配手機螢幕，操作簡單直觀
- **效率優先**：最少點擊次數完成點餐流程
- **即時性**：支援現場快速點餐和訂單傳送

## 📐 頁面佈局設計

### 🔝 頂部導航區 (固定)
```
┌─────────────────────────────────────┐
│ [🏠] TanaPOS Mobile [🛒0] [👤服務員] │
│ ┌───── 用餐方式 ─────┐              │
│ │ 🪑 內用  📦 外帶   │              │
│ └───────────────────┘              │
│ ┌─ 桌號選擇 ─┐ ┌─── 人數 ───┐      │
│ │ T01 ▼     │ │ 👥 2人 ▼  │      │
│ └───────────┘ └───────────┘      │
│ ┌─────── 訂單模式 ───────┐        │
│ │ ⚪ 新訂單  🔘 加點訂單   │        │
│ └─────────────────────────┘        │
└─────────────────────────────────────┘
```

### 外帶模式頂部導航區
```
┌─────────────────────────────────────┐
│ [🏠] TanaPOS Mobile [🛒0] [👤服務員] │
│ ┌───── 用餐方式 ─────┐              │
│ │ 🪑 內用  📦 外帶   │              │
│ └───────────────────┘              │
│ ┌───── 外帶資訊 ─────┐              │
│ │ 📞 取餐號: TO-015   │              │
│ │ 👤 客人姓名: [____] │              │
│ └───────────────────┘              │
└─────────────────────────────────────┘
```

### 🏷️ 分類標籤區 (橫向滑動)
```
┌─────────────────────────────────────┐
│ [🥗前菜] [🍖主餐] [🥤飲品] [🧁甜點] │
│           ↑選中                      │
└─────────────────────────────────────┘
```

### 📱 商品展示區 (可滑動)
```
┌─────────────────────────────────────┐
│ ┌─────┐ 打拋豬飯          💰 180   │
│ │ 圖片 │ 經典泰式風味      [+加入] │
│ └─────┘                           │
│ ┌─────┐ 綠咖哩雞          💰 220   │
│ │ 圖片 │ 椰漿濃郁香辣      [+加入] │
│ └─────┘                           │
│ ┌─────┐ 泰式奶茶          💰 60    │
│ │ 圖片 │ 香濃甜蜜滋味      [+加入] │
│ └─────┘                           │
└─────────────────────────────────────┘
```

### 🛒 浮動購物車按鈕 (右下角固定)
```
                              ┌─────┐
                              │ 🛒 3 │
                              │  總計  │
                              │ $460  │
                              └─────┘
```

## 🛒 彈出式購物車設計

### 購物車彈窗 (從下方滑出)

#### 內用訂單購物車
```
┌─────────────────────────────────────┐
│ ┌─ 購物車 ─────────────────── ✕ ┐  │
│ │                                │  │
│ │ 🪑 內用 桌號: T01  👥 2人       │  │
│ │ 📋 加點訂單 #3 (原訂單: #1, #2) │  │
│ │ ────────────────────────────   │  │
│ │ 打拋豬飯 x2              $360   │  │
│ │ [🗑️] [-] 2 [+]                 │  │
│ │                                │  │
│ │ 泰式奶茶 x1              $60    │  │
│ │ [🗑️] [-] 1 [+]                 │  │
│ │ ────────────────────────────   │  │
│ │ 小計: $420                     │  │
│ │ 服務費(10%): $42               │  │
│ │ 總計: $462                     │  │
│ │                                │  │
│ │ 📝 備註欄位                     │  │
│ │ [_________________________]   │  │
│ │                                │  │
│ │ ⚠️ 此為加點訂單，將獨立處理       │  │
│ │                                │  │
│ │ [清空] [繼續點餐] [🚀確認加點]   │  │
│ └────────────────────────────────┘  │
└─────────────────────────────────────┘
```

#### 外帶訂單購物車
```
┌─────────────────────────────────────┐
│ ┌─ 購物車 ─────────────────── ✕ ┐  │
│ │                                │  │
│ │ 📦 外帶 取餐號: TO-015          │  │
│ │ 👤 客人: 王先生                 │  │
│ │ ────────────────────────────   │  │
│ │ 打拋豬飯 x2              $360   │  │
│ │ [🗑️] [-] 2 [+]                 │  │
│ │                                │  │
│ │ 泰式奶茶 x1              $60    │  │
│ │ [🗑️] [-] 1 [+]                 │  │
│ │ ────────────────────────────   │  │
│ │ 小計: $420                     │  │
│ │ 外帶袋費: $5                   │  │
│ │ 總計: $425                     │  │
│ │                                │  │
│ │ 📝 備註欄位                     │  │
│ │ [_________________________]   │  │
│ │                                │  │
│ │ 📦 外帶訂單，請確認餐點           │  │
│ │                                │  │
│ │ [清空] [繼續點餐] [🚀確認外帶]   │  │
│ └────────────────────────────────┘  │
└─────────────────────────────────────┘
```

## ⚙️ 核心功能規劃

### 1. 桌號與人數管理
- **快速選擇**：下拉選單快速選擇桌號
- **人數設定**：簡單的人數選擇器
- **狀態記憶**：保持當前桌號直到手動更換
- **桌況檢查**：自動檢測桌台狀態，顯示現有訂單數量

### 2. 用餐方式選擇
- **內用模式**：傳統桌號+人數模式（預設）
- **外帶模式**：無需選擇桌號，系統自動分配取餐號
- **取餐號管理**：自動生成 TO-XXX 格式的取餐號碼
- **客人資訊**：外帶模式可輸入客人姓名或電話

### 3. 訂單模式切換
- **新訂單模式**：創建全新的訂單（預設模式）
- **加點模式**：為現有桌台創建額外訂單（僅限內用）
- **智慧提醒**：選擇已有訂單的桌號時自動提醒切換加點模式
- **訂單編號**：自動生成獨立的訂單編號避免混淆

### 2. 商品瀏覽與搜尋
- **分類瀏覽**：橫向滑動分類標籤
- **快速搜尋**：頂部搜尋框（可選）
- **商品資訊**：簡潔的商品卡片設計
- **一鍵加入**：大型加入按鈕

### 3. 購物車功能
- **浮動顯示**：右下角顯示數量和總額
- **彈窗操作**：點擊展開完整購物車
- **數量調整**：+-按鈕調整數量
- **商品移除**：垃圾桶圖示刪除商品
- **模式識別**：清楚標示當前為新訂單或加點訂單
- **用餐方式顯示**：區分內用和外帶訂單

### 4. 訂單處理
- **備註功能**：支援特殊需求備註
- **價格計算**：自動計算小計、服務費/外帶袋費、總計
- **即時下單**：一鍵傳送到廚房系統
- **加點管理**：獨立處理加點訂單，避免與原訂單混淆（僅限內用）
- **訂單追蹤**：顯示同桌的歷史訂單編號供參考
- **外帶處理**：外帶訂單自動加入外帶袋費，無服務費

## 🎨 UI/UX 設計原則

### 顏色主題
- **主色調**：TanaPOS 品牌色（藍色系）
- **輔助色**：
  - 成功/確認：綠色 `#10B981`
  - 警告/注意：橙色 `#F59E0B`
  - 危險/刪除：紅色 `#EF4444`
  - 中性/背景：灰色系

### 字體與尺寸
- **大標題**：24px，粗體
- **商品名稱**：18px，中粗體
- **價格**：16px，粗體
- **描述文字**：14px，常規
- **按鈕文字**：16px，中粗體

### 觸控友好設計
- **按鈕大小**：最小 44px x 44px
- **間距設定**：元素間距至少 8px
- **觸控目標**：足夠大的點擊區域
- **手勢支援**：滑動、點擊、長按

## 📱 響應式適配

### 手機直向 (Portrait)
- **螢幕寬度**：320px - 414px
- **佈局**：單欄垂直佈局
- **分類標籤**：橫向滑動
- **商品卡片**：全寬度顯示

### 手機橫向 (Landscape)
- **螢幕寬度**：568px - 896px
- **佈局**：可考慮雙欄顯示
- **高度優化**：減少垂直空間浪費

## 🔄 操作流程設計

### 典型點餐流程
#### 內用新訂單流程
1. **選擇用餐方式**：選擇「🪑內用」
2. **選擇桌號**：下拉選單選擇 T01
3. **確認模式**：選擇「新訂單」模式
4. **設定人數**：選擇 2人
5. **瀏覽商品**：滑動分類標籤
6. **加入商品**：點擊「+加入」按鈕
7. **檢視購物車**：點擊浮動購物車
8. **調整數量**：使用 +/- 按鈕
9. **添加備註**：輸入特殊需求
10. **確認下單**：點擊「🚀確認下單」

#### 內用加點流程
1. **選擇用餐方式**：選擇「🪑內用」
2. **選擇桌號**：下拉選單選擇 T01（已有訂單的桌台）
3. **系統提醒**：「此桌已有訂單 #1, #2，是否要加點？」
4. **切換模式**：選擇「加點訂單」模式
5. **瀏覽商品**：滑動分類標籤選擇要加點的商品
6. **加入商品**：點擊「+加入」按鈕
7. **檢視購物車**：購物車顯示「加點訂單 #3」
8. **調整數量**：使用 +/- 按鈕
9. **添加備註**：輸入加點說明（如：「客人要求辣一點」）
10. **確認加點**：點擊「🚀確認加點」

#### 外帶訂單流程
1. **選擇用餐方式**：選擇「📦外帶」
2. **系統分配**：自動生成取餐號 TO-015
3. **輸入客人資訊**：輸入客人姓名或電話（可選）
4. **瀏覽商品**：滑動分類標籤
5. **加入商品**：點擊「+加入」按鈕
6. **檢視購物車**：點擊浮動購物車
7. **調整數量**：使用 +/- 按鈕
8. **添加備註**：輸入特殊需求（如：「不要辣」、「餐具分開裝」）
9. **確認外帶**：點擊「🚀確認外帶」

### 錯誤處理
- **空購物車**：提示至少選擇一項商品
- **未選桌號**：提醒選擇桌號（僅限內用模式）
- **網路異常**：顯示離線提示和重試按鈕
- **桌況衝突**：
  - 選擇已結帳桌號：提醒桌台已結帳，建議選擇新訂單模式
  - 選擇空桌加點：提醒此桌無現有訂單，建議切換為新訂單模式
  - 訂單過多警告：同桌超過5個訂單時提醒確認
- **外帶模式錯誤**：
  - 外帶模式選擇加點：提醒外帶無法加點，建議創建新的外帶訂單
  - 取餐號重複：自動重新生成唯一的取餐號碼

## 🚀 技術實現要點

### 核心組件
- `MobileOrderingPage.tsx` - 主頁面組件
- `DiningModeSelector.tsx` - 內用/外帶模式選擇組件
- `OrderModeSelector.tsx` - 訂單模式切換組件
- `ProductCategoryTabs.tsx` - 分類標籤組件
- `ProductCard.tsx` - 商品卡片組件
- `FloatingCart.tsx` - 浮動購物車組件
- `CartModal.tsx` - 購物車彈窗組件
- `TableSelector.tsx` - 桌號選擇器組件
- `TakeawayInfoInput.tsx` - 外帶資訊輸入組件
- `TableStatusChecker.tsx` - 桌況檢查組件
- `AdditionalOrderManager.tsx` - 加點訂單管理組件
- `TakeawayNumberGenerator.tsx` - 取餐號生成器組件

### 狀態管理
- **購物車狀態**：使用 Zustand 或 Context
- **商品數據**：從 API 獲取
- **桌號狀態**：本地狀態保存
- **訂單狀態**：提交狀態管理
- **用餐方式**：內用/外帶模式狀態
- **訂單模式**：新訂單/加點模式切換（僅限內用）
- **桌況監控**：即時檢查桌台訂單狀態
- **加點記錄**：同桌訂單歷史追蹤
- **取餐號管理**：外帶訂單號碼生成和追蹤
- **客人資訊**：外帶客人姓名/電話記錄

### 性能優化
- **圖片懶加載**：商品圖片延遲載入
- **虛擬滾動**：大量商品時使用
- **緩存策略**：商品數據緩存
- **離線支援**：基本離線功能

## 📊 成功指標

### 使用者體驗指標
- **點餐完成時間**：< 2分鐘
- **錯誤率**：< 5%
- **滿意度**：> 4.5/5

### 技術性能指標
- **首次載入時間**：< 3秒
- **操作響應時間**：< 300ms
- **離線可用性**：基本功能可離線使用

## 🎯 後續擴展功能

### Phase 2 功能
- **商品搜尋**：快速搜尋商品
- **常用組合**：預設餐點組合
- **歷史訂單**：快速重複下單
- **多語言支援**：中英文切換

### Phase 3 功能
- **語音點餐**：語音輸入商品
- **掃碼點餐**：QR碼快速點餐
- **智慧推薦**：根據時間推薦商品
- **報表統計**：服務員績效統計

---

這個設計規劃著重於**簡潔、快速、直觀**的使用體驗，專為服務員在忙碌環境中快速完成點餐任務而設計。

## 🍽️ 加點功能詳細說明

### 功能目標
解決餐廳實際營運中的常見問題：
- **避免桌況限制**：當桌台狀態不允許修改原訂單時，仍能進行加點
- **獨立訂單管理**：每次加點創建新的獨立訂單，便於廚房分批處理
- **避免混淆**：清楚區分原訂單與加點訂單，減少服務錯誤

### 技術實現邏輯

#### 桌況檢測機制
```typescript
interface TableStatus {
  tableNumber: string;
  existingOrders: Order[];
  currentStatus: 'empty' | 'occupied' | 'ready_to_pay' | 'paid';
  canAddItems: boolean;
  canCreateAdditionalOrder: boolean;
}

const checkTableStatus = async (tableNumber: string): Promise<TableStatus> => {
  // 檢查桌台現有訂單狀態
  // 判斷是否可以加點或需要創建新訂單
}
```

#### 訂單模式管理
```typescript
type OrderMode = 'new' | 'additional';

interface OrderContext {
  mode: OrderMode;
  tableNumber: string;
  relatedOrders: string[]; // 同桌其他訂單ID
  orderSequence: number;   // 該桌第幾個訂單
}
```

#### 智慧提醒系統
1. **選擇已有訂單的桌號**：
   ```
   ⚠️ 提醒對話框
   ┌─────────────────────────────────┐
   │ 桌號 T01 已有訂單               │
   │                                 │
   │ 現有訂單：#001, #002           │
   │ 狀態：進行中                   │
   │                                 │
   │ 您要：                         │
   │ [📝 修改現有訂單] [➕ 創建加點] │
   └─────────────────────────────────┘
   ```

2. **選擇空桌進行加點**：
   ```
   ⚠️ 警告對話框
   ┌─────────────────────────────────┐
   │ 桌號 T05 目前沒有訂單           │
   │                                 │
   │ 建議切換為「新訂單」模式       │
   │                                 │
   │ [🔄 切換新訂單] [✓ 仍要加點]   │
   └─────────────────────────────────┘
   ```

### 訂單編號規則
#### 內用訂單
- **新訂單**：`T01-001` (桌號-流水號)
- **加點訂單**：`T01-001-A1` (原訂單號-加點序號)
- **多次加點**：`T01-001-A1`, `T01-001-A2`, `T01-001-A3`

#### 外帶訂單
- **外帶訂單**：`TOGO-001` (TOGO前綴-流水號)
- **當日重置**：每日 00:00 重新從 001 開始
- **取餐號**：`TO-015` (顯示給客人的簡短號碼)
- **對應關係**：`TOGO-015` ↔ `TO-015`

### 廚房顯示差異
#### KDS 系統顯示

##### 內用訂單
- **新訂單**：正常顯示，標示桌號和人數
- **加點訂單**：
  ```
  ┌─────────────────────┐
  │ 🔸 加點訂單          │
  │ 桌號: T01  (+加點)   │
  │ 訂單: #001-A1       │
  │ 時間: 14:30         │
  │ ─────────────────── │
  │ 泰式奶茶 x2         │
  │ 春捲 x1             │
  └─────────────────────┘
  ```

##### 外帶訂單
- **外帶訂單**：明顯標示外帶，顯示取餐號
  ```
  ┌─────────────────────┐
  │ 📦 外帶訂單          │
  │ 取餐號: TO-015      │
  │ 客人: 王先生        │
  │ 訂單: TOGO-015      │
  │ 時間: 14:30         │
  │ ─────────────────── │
  │ 打拋豬飯 x2         │
  │ 泰式奶茶 x1         │
  │ 🥡 需外帶包裝        │
  └─────────────────────┘
  ```

### 結帳整合
#### 內用結帳
- **統一結帳**：系統可選擇將同桌所有訂單合併結帳
- **分開結帳**：每個訂單可獨立結帳
- **部分結帳**：客人可選擇先結部分訂單

#### 外帶結帳
- **即時結帳**：外帶訂單通常下單即結帳
- **預付模式**：支援預付款，取餐時核對
- **後付模式**：取餐時現場付款

### 報表統計
- **營業額分析**：區分內用、外帶、新訂單與加點訂單的營收貢獻
- **服務效率**：追蹤加點頻率，評估服務品質
- **商品分析**：分析哪些商品常被加點，優化庫存配置
- **外帶趨勢**：分析外帶訂單時段和熱門商品
- **取餐效率**：追蹤外帶訂單從下單到取餐的時間

### 客戶體驗提升
1. **減少等待**：不需等原訂單完成即可加點
2. **彈性服務**：滿足客人臨時需求
3. **避免錯誤**：清楚區分不同批次的訂單
4. **提升滿意度**：服務員能快速響應客人需求

這個加點功能設計確保了營運的靈活性，同時維持了系統的清晰度和準確性。

## 📦 外帶功能詳細說明

### 功能目標
提供完整的外帶點餐解決方案：
- **無桌號限制**：外帶不需要選擇桌號，簡化流程
- **清楚識別**：廚房能快速識別內用和外帶訂單
- **取餐管理**：系統化的取餐號碼和客人資訊管理
- **包裝提醒**：自動提醒廚房進行外帶包裝

### 技術實現邏輯

#### 用餐方式檢測
```typescript
type DiningMode = 'dine_in' | 'takeaway';

interface OrderContext {
  diningMode: DiningMode;
  tableNumber?: string;  // 僅限內用
  takeawayNumber?: string; // 僅限外帶
  customerInfo?: {
    name?: string;
    phone?: string;
  };
}
```

#### 取餐號生成器
```typescript
interface TakeawayNumberGenerator {
  generateNumber(): string;
  getCurrentDate(): string;
  getNextSequence(): number;
  formatTakeawayNumber(sequence: number): string;
}

// 實現邏輯
const generateTakeawayNumber = (): string => {
  const today = new Date().toISOString().split('T')[0];
  const sequence = getNextSequenceForDate(today);
  return `TOGO-${sequence.toString().padStart(3, '0')}`;
};

const generatePickupNumber = (fullNumber: string): string => {
  // TOGO-015 → TO-015
  return fullNumber.replace('TOGO-', 'TO-');
};
```

#### 價格計算差異
```typescript
interface PriceCalculation {
  subtotal: number;
  serviceCharge?: number;  // 僅限內用
  takeawayBagFee?: number; // 僅限外帶
  total: number;
}

const calculateOrderTotal = (
  items: OrderItem[], 
  diningMode: DiningMode
): PriceCalculation => {
  const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  
  if (diningMode === 'dine_in') {
    const serviceCharge = subtotal * 0.1; // 10% 服務費
    return {
      subtotal,
      serviceCharge,
      total: subtotal + serviceCharge
    };
  } else {
    const takeawayBagFee = 5; // 外帶袋費 $5
    return {
      subtotal,
      takeawayBagFee,
      total: subtotal + takeawayBagFee
    };
  }
};
```

### UI/UX 差異化設計

#### 視覺識別系統
- **內用顏色**：藍色系 `#3B82F6`（沉穩、穩定）
- **外帶顏色**：橙色系 `#F59E0B`（活力、快速）
- **圖示差異**：
  - 內用：🪑 椅子圖示
  - 外帶：📦 包裹圖示

#### 購物車提醒差異
```
內用購物車：
⚠️ 此為加點訂單，將獨立處理

外帶購物車：
📦 外帶訂單，請確認餐點
🥡 將提供外帶包裝服務
```

### 操作流程優化

#### 外帶專用功能
1. **自動取餐號**：選擇外帶後立即生成並顯示
2. **客人資訊**：可選輸入，但建議填寫聯絡方式
3. **包裝備註**：預設包裝選項（如：分開裝、不要餐具等）
4. **取餐提醒**：訂單完成後自動通知客人

#### 廚房工作流程
1. **訂單識別**：外帶訂單有明顯的視覺標識
2. **包裝提醒**：完成料理後提醒進行外帶包裝
3. **取餐通知**：包裝完成後通知前台客人可取餐
4. **訂單追蹤**：記錄從下單到取餐的完整時間

### 系統整合設計

#### 與現有系統的整合
- **KDS 系統**：外帶訂單在廚房顯示系統中有特殊標識
- **POS 系統**：支援外帶訂單的結帳和退款
- **庫存系統**：外帶包裝材料的消耗追蹤
- **報表系統**：內用外帶分別統計和分析

#### 資料庫設計
```sql
-- 訂單表新增欄位
ALTER TABLE orders ADD COLUMN dining_mode VARCHAR(20) DEFAULT 'dine_in';
ALTER TABLE orders ADD COLUMN takeaway_number VARCHAR(20) NULL;
ALTER TABLE orders ADD COLUMN customer_name VARCHAR(100) NULL;
ALTER TABLE orders ADD COLUMN customer_phone VARCHAR(20) NULL;
ALTER TABLE orders ADD COLUMN pickup_time TIMESTAMP NULL;

-- 外帶號碼序列表
CREATE TABLE takeaway_sequences (
  date DATE PRIMARY KEY,
  last_sequence INTEGER DEFAULT 0
);
```

### 營運優勢

#### 對餐廳的好處
1. **增加營收**：拓展外帶客群，不受座位限制
2. **提升效率**：外帶流程更快速，提高翻桌率
3. **減少等候**：分流內用和外帶客人
4. **數據分析**：更精確的營運數據分析

#### 對客人的好處
1. **方便快速**：不需等座位，隨點隨取
2. **清楚標識**：取餐號碼清楚，不會搞混
3. **彈性時間**：可預先點餐，指定取餐時間
4. **避免接觸**：減少在店內停留時間

### 未來擴展功能

#### Phase 2 功能
- **預約取餐**：客人可指定未來取餐時間
- **線上支付**：整合行動支付，取餐免排隊
- **取餐通知**：SMS/App 推播通知取餐
- **評價系統**：外帶服務品質評分

#### Phase 3 功能
- **外送整合**：與外送平台 API 串接
- **會員系統**：外帶常客優惠和積點
- **AI 預測**：預測外帶熱門時段和商品
- **自助取餐**：QR Code 自助取餐櫃

這個外帶功能設計完整解決了餐廳內用外帶並行的營運需求，提供清晰的操作流程和系統架構。
