# 🚀 立即預訂功能修復指南

## 📋 問題診斷結果

### ❌ 發現的問題
1. **缺少資料庫欄位**: `table_reservations` 表缺少 `reservation_type` 欄位
2. **最小提前時間限制**: 當前設定為 2 小時提前預訂
3. **前端欄位映射**: 預約物件缺少必要的欄位

### 🔧 解決方案

#### 步驟 1: 執行 SQL 修復腳本
請到 **Supabase SQL 編輯器** 執行 `fix-reservation-immediate.sql` 腳本：

**關鍵修復內容**:
```sql
-- 添加缺少的欄位
ALTER TABLE public.table_reservations 
ADD COLUMN IF NOT EXISTS reservation_type VARCHAR(50) DEFAULT 'dining';

ALTER TABLE public.table_reservations 
ADD COLUMN IF NOT EXISTS adult_count INTEGER DEFAULT 0;

ALTER TABLE public.table_reservations 
ADD COLUMN IF NOT EXISTS child_count INTEGER DEFAULT 0;

ALTER TABLE public.table_reservations 
ADD COLUMN IF NOT EXISTS child_chair_needed BOOLEAN DEFAULT FALSE;

-- 設定立即預訂（0小時提前）
UPDATE public.restaurants 
SET reservation_settings = jsonb_set(
    reservation_settings,
    '{reservationSettings,minAdvanceBookingHours}',
    '0'::jsonb
)
WHERE id = '11111111-1111-1111-1111-111111111111';
```

#### 步驟 2: 驗證修復
執行測試腳本確認修復成功：
```bash
node test-immediate-booking.cjs
```

## 🎯 修復完成後的功能

### ✅ 立即預訂
- **0 小時提前預訂**: 可以預訂當下時間的位置
- **即時生效**: 不需要等待確認

### ✅ 完整欄位支援
- `reservation_type`: 預約類型（dining, business, etc.）
- `adult_count`: 成人數量
- `child_count`: 兒童數量  
- `child_chair_needed`: 是否需要兒童椅

### ✅ 時段顯示
- 顯示當天所有營業時段
- 不過濾已過時間（允許立即預訂）
- 正確顯示剩餘容量

## 📱 前端使用方式

### 現在可以：
1. **選擇當天日期**
2. **選擇任何營業時間** (14:00-19:30)
3. **立即提交預約** - 無需等待
4. **獲得即時確認**

### 營業時間:
- **每日**: 14:00 - 21:00
- **最晚預約**: 19:30
- **用餐時長**: 90 分鐘
- **時段間隔**: 30 分鐘

## 🔄 執行順序

1. **立即執行**: `fix-reservation-immediate.sql` (在 Supabase SQL 編輯器)
2. **驗證修復**: `node test-immediate-booking.cjs`
3. **測試前端**: 重新整理預約頁面並測試

## ⚠️ 注意事項

- 執行 SQL 後立即生效，無需重啟應用程式
- 已修復前端代碼中的欄位映射問題
- 測試腳本會自動清理測試資料

---

**🎉 修復完成後，你就可以在任何營業時間立即預訂位置了！**

**執行狀態**: ⏳ 等待 SQL 腳本執行  
**預期結果**: ✅ 支援立即預訂  
**下一步**: 執行 `fix-reservation-immediate.sql`
