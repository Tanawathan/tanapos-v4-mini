# ğŸš€ TanaPOS V4-AI é ç´„ç³»çµ±è³‡æ–™åº«è¨­å®šæŒ‡å—

## ğŸ“‹ ç•¶å‰ç‹€æ…‹
âœ… ç’°å¢ƒè®Šæ•¸è¨­å®šå®Œæˆ (Supabase API Key å·²é…ç½®)  
âœ… æ¡Œå°è³‡æ–™å·²å­˜åœ¨ (5å€‹æ¡Œå°)  
âŒ éœ€è¦åŸ·è¡Œ SQL è¨­å®š (reservation_settings æ¬„ä½å’Œ restaurant_holidays è¡¨)

## ğŸ¯ ç«‹å³åŸ·è¡Œæ­¥é©Ÿ

### æ­¥é©Ÿ 1: é–‹å•Ÿ Supabase å„€è¡¨æ¿
1. å‰å¾€: https://supabase.com/dashboard
2. é¸æ“‡ä½ çš„å°ˆæ¡ˆ: `arksfwmcmwnyxvlcpskm`
3. é»æ“Šå·¦å´é¸å–®çš„ "SQL Editor"

### æ­¥é©Ÿ 2: åŸ·è¡Œ SQL è¨­å®š
1. åœ¨ SQL ç·¨è¼¯å™¨ä¸­ï¼Œè¤‡è£½ä¸¦åŸ·è¡Œ `manual-sql-setup.sql` æ–‡ä»¶çš„å…§å®¹
2. æˆ–è€…é€ä¸€åŸ·è¡Œä»¥ä¸‹ SQL å‘½ä»¤ï¼š

#### å‘½ä»¤ 1: æ·»åŠ é ç´„è¨­å®šæ¬„ä½
```sql
ALTER TABLE public.restaurants 
ADD COLUMN IF NOT EXISTS reservation_settings JSONB DEFAULT '{
    "businessHours": {
        "monday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "tuesday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "wednesday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "thursday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "friday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "saturday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"},
        "sunday": {"isOpen": true, "openTime": "14:00", "closeTime": "21:00"}
    },
    "reservationSettings": {
        "slotDurationMinutes": 30,
        "maxAdvanceBookingDays": 30,
        "minAdvanceBookingHours": 2,
        "mealDurationMinutes": 90,
        "lastReservationTime": "19:30"
    },
    "autoAssignment": {
        "enabled": true,
        "preferenceWeight": 0.3,
        "capacityWeight": 0.5,
        "aiPriorityWeight": 0.2
    }
}'::jsonb;
```

#### å‘½ä»¤ 2: å‰µå»ºå‡æœŸè¡¨
```sql
CREATE TABLE IF NOT EXISTS public.restaurant_holidays (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    restaurant_id UUID NOT NULL REFERENCES public.restaurants(id) ON DELETE CASCADE,
    holiday_date DATE NOT NULL,
    holiday_name VARCHAR(255) NOT NULL,
    is_recurring BOOLEAN DEFAULT FALSE,
    recurrence_type VARCHAR(20) CHECK (recurrence_type IN ('yearly', 'monthly', 'weekly')) DEFAULT NULL,
    is_closed BOOLEAN DEFAULT TRUE,
    special_hours JSONB DEFAULT NULL,
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(restaurant_id, holiday_date)
);
```

#### å‘½ä»¤ 3: å‰µå»ºç´¢å¼•
```sql
CREATE INDEX IF NOT EXISTS idx_restaurant_holidays_restaurant_date 
ON public.restaurant_holidays(restaurant_id, holiday_date);

CREATE INDEX IF NOT EXISTS idx_restaurant_holidays_date_range 
ON public.restaurant_holidays(holiday_date);
```

#### å‘½ä»¤ 4: è¨­å®š RLS
```sql
ALTER TABLE public.restaurant_holidays ENABLE ROW LEVEL SECURITY;

DROP POLICY IF EXISTS "Users can view holidays for their restaurant" ON public.restaurant_holidays;
CREATE POLICY "Users can view holidays for their restaurant" 
ON public.restaurant_holidays FOR SELECT 
USING (restaurant_id IN (
    SELECT r.id FROM public.restaurants r 
    WHERE r.id = restaurant_holidays.restaurant_id
));

DROP POLICY IF EXISTS "Users can manage holidays for their restaurant" ON public.restaurant_holidays;
CREATE POLICY "Users can manage holidays for their restaurant" 
ON public.restaurant_holidays FOR ALL 
USING (restaurant_id IN (
    SELECT r.id FROM public.restaurants r 
    WHERE r.id = restaurant_holidays.restaurant_id
));
```

### æ­¥é©Ÿ 3: é©—è­‰è¨­å®š
åŸ·è¡Œé©—è­‰è…³æœ¬ç¢ºèªè¨­å®šæˆåŠŸï¼š
```bash
node verify-reservation-setup.cjs
```

## ğŸ¯ å®Œæˆå¾ŒåŠŸèƒ½
- âœ… æ¯æ—¥ 14:00-21:00 ç‡Ÿæ¥­æ™‚é–“
- âœ… 90åˆ†é˜ç”¨é¤æ™‚é•·  
- âœ… æœ€æ™š 19:30 é ç´„
- âœ… å‡æœŸç®¡ç†æ—¥æ›†
- âœ… è‡ªå‹•æ¡Œå°åˆ†é…

## ğŸ“ ç›¸é—œæª”æ¡ˆ
- `manual-sql-setup.sql` - å®Œæ•´ SQL è¨­å®šè…³æœ¬
- `verify-reservation-setup.cjs` - é©—è­‰è…³æœ¬
- `execute-sql-setup.cjs` - è‡ªå‹•åŸ·è¡Œè…³æœ¬ (API é™åˆ¶ç„¡æ³•ä½¿ç”¨)

## ğŸš¨ é‡è¦æé†’
åŸ·è¡Œ SQL å¾Œç«‹å³é©—è­‰ï¼Œå¦‚æœå‡ºç¾éŒ¯èª¤è«‹æª¢æŸ¥ï¼š
1. Supabase å°ˆæ¡ˆæ˜¯å¦æ­£ç¢º
2. æ˜¯å¦æœ‰æ¬Šé™åŸ·è¡Œ DDL å‘½ä»¤
3. æ˜¯å¦å·²ç¶“å­˜åœ¨ç›¸åŒåç¨±çš„è¡¨æˆ–æ¬„ä½

---

**ğŸ‰ åŸ·è¡Œå®Œæˆå¾Œï¼Œé ç´„ç³»çµ±å°‡å®Œå…¨å¯ç”¨ï¼**
