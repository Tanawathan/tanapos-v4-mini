# ğŸš€ TanaPOS v4 è³‡æ–™åº«éƒ¨ç½²æŒ‡å—

**ç‰ˆæœ¬**: v4.0  
**æ—¥æœŸ**: 2025-08-05  

---

## ğŸ“‹ éƒ¨ç½²æª¢æŸ¥æ¸…å–®

### âœ… éƒ¨ç½²å‰æº–å‚™
- [ ] ç¢ºèª Supabase å°ˆæ¡ˆå·²å»ºç«‹
- [ ] å–å¾—è³‡æ–™åº«é€£ç·šè³‡è¨Š
- [ ] å‚™ä»½ç¾æœ‰è³‡æ–™ï¼ˆå¦‚æœ‰ï¼‰
- [ ] æº–å‚™æ¸¬è©¦è³‡æ–™

### âœ… éƒ¨ç½²æ­¥é©Ÿ
1. [ ] åŸ·è¡Œå®Œæ•´ SQL æ¶æ§‹
2. [ ] é©—è­‰è³‡æ–™è¡¨å»ºç«‹
3. [ ] è¼‰å…¥åˆå§‹è³‡æ–™
4. [ ] è¨­å®šæ¬Šé™èˆ‡å®‰å…¨
5. [ ] æ¸¬è©¦åŠŸèƒ½é‹ä½œ

---

## ğŸ”§ éƒ¨ç½²æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Supabase Dashboard
1. ç™»å…¥ Supabase Dashboard
2. é€²å…¥ SQL Editor
3. è¤‡è£½ `supabase_complete.sql` å…§å®¹
4. åŸ·è¡Œ SQL è…³æœ¬
5. æª¢æŸ¥åŸ·è¡Œçµæœ

### æ–¹æ³•äºŒï¼šä½¿ç”¨ psql å‘½ä»¤åˆ—
```bash
# é€£ç·šåˆ° Supabase è³‡æ–™åº«
psql "postgresql://postgres:[YOUR-PASSWORD]@[YOUR-HOST]:5432/postgres"

# åŸ·è¡Œ SQL æª”æ¡ˆ
\i supabase_complete.sql

# æª¢æŸ¥è³‡æ–™è¡¨
\dt
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ Supabase CLI
```bash
# å®‰è£ Supabase CLI
npm install -g supabase

# åˆå§‹åŒ–å°ˆæ¡ˆ
supabase init

# åŸ·è¡Œé·ç§»
supabase db push
```

---

## ğŸ“Š éƒ¨ç½²é©—è­‰

### 1. è³‡æ–™è¡¨æª¢æŸ¥
```sql
-- æª¢æŸ¥è³‡æ–™è¡¨æ•¸é‡
SELECT COUNT(*) FROM information_schema.tables 
WHERE table_schema = 'public';

-- æ‡‰è©²é¡¯ç¤º 35+ å€‹è³‡æ–™è¡¨
```

### 2. ç´¢å¼•æª¢æŸ¥
```sql
-- æª¢æŸ¥ç´¢å¼•
SELECT schemaname, tablename, indexname 
FROM pg_indexes 
WHERE schemaname = 'public'
ORDER BY tablename;
```

### 3. è§¸ç™¼å™¨æª¢æŸ¥
```sql
-- æª¢æŸ¥è§¸ç™¼å™¨
SELECT trigger_name, event_object_table 
FROM information_schema.triggers 
WHERE trigger_schema = 'public';
```

### 4. æ¸¬è©¦è³‡æ–™é©—è­‰
```sql
-- æª¢æŸ¥åˆå§‹è³‡æ–™
SELECT * FROM restaurants WHERE id = '11111111-1111-1111-1111-111111111111';
SELECT COUNT(*) FROM categories;
```

---

## ğŸ”‘ ç’°å¢ƒè®Šæ•¸è¨­å®š

æ›´æ–°ä½ çš„ `.env` æª”æ¡ˆï¼š

```env
# Supabase è¨­å®š
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key

# è³‡æ–™åº«è¨­å®š
DATABASE_URL=postgresql://postgres:password@host:5432/postgres

# æ¸¬è©¦é¤å»³ ID
VITE_TEST_RESTAURANT_ID=11111111-1111-1111-1111-111111111111
```

---

## ğŸ§ª åŠŸèƒ½æ¸¬è©¦

### 1. åŸºç¤ API æ¸¬è©¦
```javascript
// æ¸¬è©¦åˆ†é¡è¼‰å…¥
const { data: categories } = await supabase
  .from('categories')
  .select('*')
  .eq('restaurant_id', '11111111-1111-1111-1111-111111111111');

console.log('åˆ†é¡æ•¸é‡:', categories?.length);

// æ¸¬è©¦å•†å“è¼‰å…¥
const { data: products } = await supabase
  .from('products')
  .select('*, category:categories(*)')
  .eq('restaurant_id', '11111111-1111-1111-1111-111111111111');

console.log('å•†å“æ•¸é‡:', products?.length);
```

### 2. é—œè¯æŸ¥è©¢æ¸¬è©¦
```sql
-- æ¸¬è©¦è¨‚å–®é—œè¯æŸ¥è©¢
SELECT o.order_number, oi.product_name, t.table_number
FROM orders o
JOIN order_items oi ON o.id = oi.order_id
JOIN tables t ON o.table_id = t.id
LIMIT 5;
```

### 3. å³æ™‚åŠŸèƒ½æ¸¬è©¦
```javascript
// æ¸¬è©¦å³æ™‚è¨‚é–±
const subscription = supabase
  .channel('orders')
  .on('postgres_changes', { 
    event: 'INSERT', 
    schema: 'public', 
    table: 'orders' 
  }, (payload) => {
    console.log('æ–°è¨‚å–®:', payload.new);
  })
  .subscribe();
```

---

## ğŸ”’ å®‰å…¨æ€§è¨­å®š

### 1. RLS æ”¿ç­–è¨­å®š
```sql
-- é¤å»³è³‡æ–™éš”é›¢
CREATE POLICY "é¤å»³è³‡æ–™éš”é›¢" ON restaurants 
FOR ALL USING (auth.jwt() ->> 'restaurant_id' = id::text);

-- è¨‚å–®å­˜å–æ§åˆ¶
CREATE POLICY "è¨‚å–®å­˜å–æ§åˆ¶" ON orders 
FOR ALL USING (auth.jwt() ->> 'restaurant_id' = restaurant_id::text);
```

### 2. è§’è‰²æ¬Šé™è¨­å®š
```sql
-- å»ºç«‹è§’è‰²
CREATE ROLE pos_user;
CREATE ROLE pos_admin;
CREATE ROLE pos_kitchen;

-- è¨­å®šæ¬Šé™
GRANT SELECT, INSERT, UPDATE ON orders TO pos_user;
GRANT ALL ON ALL TABLES IN SCHEMA public TO pos_admin;
GRANT SELECT, UPDATE ON order_items TO pos_kitchen;
```

---

## ğŸ“ˆ æ•ˆèƒ½èª¿æ•´

### 1. é€£ç·šæ± è¨­å®š
```javascript
// Supabase å®¢æˆ¶ç«¯è¨­å®š
const supabase = createClient(supabaseUrl, supabaseKey, {
  db: {
    schema: 'public',
  },
  auth: {
    persistSession: true,
  },
  realtime: {
    params: {
      eventsPerSecond: 10,
    },
  },
});
```

### 2. æŸ¥è©¢å„ªåŒ–è¨­å®š
```sql
-- è¨­å®šæŸ¥è©¢è¨ˆåŠƒå¿«å–
SET shared_preload_libraries = 'pg_stat_statements';

-- è¨­å®šè¨˜æ†¶é«”åƒæ•¸
SET work_mem = '256MB';
SET shared_buffers = '512MB';
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. è³‡æ–™è¡¨å»ºç«‹å¤±æ•—
**ç—‡ç‹€**: SQL åŸ·è¡ŒéŒ¯èª¤  
**è§£æ±º**: æª¢æŸ¥æ¬Šé™ï¼Œç¢ºèªä»¥ postgres ä½¿ç”¨è€…åŸ·è¡Œ

#### 2. ç´¢å¼•å»ºç«‹å¤±æ•—
**ç—‡ç‹€**: ç´¢å¼•é‡è¤‡éŒ¯èª¤  
**è§£æ±º**: åˆªé™¤ç¾æœ‰ç´¢å¼•å¾Œé‡æ–°å»ºç«‹

#### 3. è§¸ç™¼å™¨ç„¡æ³•åŸ·è¡Œ
**ç—‡ç‹€**: å‡½æ•¸ä¸å­˜åœ¨éŒ¯èª¤  
**è§£æ±º**: ç¢ºèªå‡½æ•¸å·²æ­£ç¢ºå»ºç«‹

#### 4. RLS æ”¿ç­–é˜»æ“‹æŸ¥è©¢
**ç—‡ç‹€**: æŸ¥è©¢è¿”å›ç©ºçµæœ  
**è§£æ±º**: æš«æ™‚åœç”¨ RLS æˆ–èª¿æ•´æ”¿ç­–

### åµéŒ¯æŒ‡ä»¤
```sql
-- æª¢æŸ¥é€£ç·šç‹€æ…‹
SELECT * FROM pg_stat_activity;

-- æª¢æŸ¥é–å®šç‹€æ³
SELECT * FROM pg_locks;

-- æª¢æŸ¥æ…¢æŸ¥è©¢
SELECT query, calls, total_time 
FROM pg_stat_statements 
ORDER BY total_time DESC;
```

---

## ğŸ“ æ”¯æ´è³‡æº

### æ–‡ä»¶é€£çµ
- [Supabase æ–‡ä»¶](https://supabase.com/docs)
- [PostgreSQL æ–‡ä»¶](https://www.postgresql.org/docs/)
- [RLS è¨­å®šæŒ‡å—](https://supabase.com/docs/guides/auth/row-level-security)

### ç¤¾ç¾¤æ”¯æ´
- [Supabase Discord](https://discord.supabase.com/)
- [PostgreSQL ç¤¾ç¾¤](https://www.postgresql.org/community/)

---

## âœ… éƒ¨ç½²å®Œæˆç¢ºèª

å®Œæˆéƒ¨ç½²å¾Œï¼Œè«‹ç¢ºèªä»¥ä¸‹é …ç›®ï¼š

- [ ] âœ… æ‰€æœ‰è³‡æ–™è¡¨å·²å»ºç«‹
- [ ] âœ… ç´¢å¼•é‹ä½œæ­£å¸¸
- [ ] âœ… è§¸ç™¼å™¨åŠŸèƒ½æ­£å¸¸
- [ ] âœ… åˆå§‹è³‡æ–™å·²è¼‰å…¥
- [ ] âœ… æ¬Šé™è¨­å®šæ­£ç¢º
- [ ] âœ… å³æ™‚åŠŸèƒ½é‹ä½œ
- [ ] âœ… å‰ç«¯é€£ç·šæˆåŠŸ
- [ ] âœ… åŸºç¤åŠŸèƒ½æ¸¬è©¦é€šé

---

**éƒ¨ç½²å®Œæˆï¼ğŸ‰**

ä½ çš„ TanaPOS v4 AI è³‡æ–™åº«ç¾åœ¨å·²ç¶“æº–å‚™å¥½æ”¯æ´å®Œæ•´çš„é¤å»³ç®¡ç†åŠŸèƒ½äº†ã€‚
