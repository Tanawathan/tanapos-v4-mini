# ğŸ½ï¸ TanaPOS v4 AI é ç´„ç³»çµ±é–‹ç™¼è¦åŠƒæ–‡ä»¶

## ğŸ“‹ ç›®éŒ„
1. [ç¾æ³åˆ†æ](#ç¾æ³åˆ†æ)
2. [ç³»çµ±éœ€æ±‚](#ç³»çµ±éœ€æ±‚)
3. [è³‡æ–™åº«çµæ§‹](#è³‡æ–™åº«çµæ§‹)
4. [æ¥­å‹™è¦å‰‡](#æ¥­å‹™è¦å‰‡)
5. [æŠ€è¡“æ¶æ§‹](#æŠ€è¡“æ¶æ§‹)
6. [é–‹ç™¼è¨ˆåŠƒ](#é–‹ç™¼è¨ˆåŠƒ)
7. [æ¸¬è©¦è¦åŠƒ](#æ¸¬è©¦è¦åŠƒ)

---

## ğŸ” ç¾æ³åˆ†æ

### ç›®å‰å·²å…·å‚™çš„åŸºç¤è¨­æ–½

#### âœ… é¤å»³åŸºç¤è³‡æ–™
- **é¤å»³è³‡æ–™è¡¨**: `restaurants`
- **ç‡Ÿæ¥­æ™‚é–“æ”¯æ´**: `business_hours` (JSONæ ¼å¼)
  ```json
  {
    "monday": {"open": "09:00", "close": "22:00"},
    "tuesday": {"open": "09:00", "close": "22:00"},
    "wednesday": {"open": "09:00", "close": "22:00"},
    "thursday": {"open": "09:00", "close": "22:00"},
    "friday": {"open": "09:00", "close": "23:00"},
    "saturday": {"open": "09:00", "close": "23:00"},
    "sunday": {"open": "10:00", "close": "21:00"}
  }
  ```
- **ç³»çµ±è¨­å®š**: `settings` (JSONæ ¼å¼ï¼Œæ”¯æ´è‡ªè¨‚è¦å‰‡)

#### âœ… æ¡Œå°ç®¡ç†ç³»çµ±
- **æ¡Œå°è³‡æ–™è¡¨**: `tables` (26å€‹æ¬„ä½ï¼ŒåŠŸèƒ½å®Œæ•´)
- **æ¡Œå°ç‹€æ…‹**: `available`, `occupied`, `reserved`, `cleaning`, `maintenance`, `inactive`
- **å®¹é‡ç®¡ç†**: `capacity`, `min_capacity`, `max_capacity`
- **ç©ºé–“è³‡è¨Š**: `floor_level`, `zone`, `position_x`, `position_y`
- **æ™ºèƒ½åˆ†é…**: `ai_assignment_priority`, `ai_features_score`

#### âœ… é ç´„ç³»çµ±åŸºç¤æ¶æ§‹
- **é ç´„è³‡æ–™è¡¨**: `table_reservations` (22å€‹æ¬„ä½)
  - å®¢æˆ¶è³‡è¨Š: `customer_name`, `customer_phone`, `customer_email`
  - é ç´„è©³æƒ…: `party_size`, `reservation_time`, `duration_minutes`
  - ç‹€æ…‹ç®¡ç†: `status` (`pending`, `confirmed`, `seated`, `completed`, `cancelled`, `no_show`)
  - ç‰¹æ®Šéœ€æ±‚: `special_requests`, `occasion`
  - è²¡å‹™ç®¡ç†: `deposit_amount`, `deposit_paid`

#### âœ… æ¡Œå°æœƒè©±ç®¡ç†
- **æœƒè©±è³‡æ–™è¡¨**: `table_sessions`
- **è¨‚å–®é—œè¯**: èˆ‡ `orders` è¡¨æ•´åˆ
- **ç‹€æ…‹è¿½è¹¤**: æ”¯æ´å³æ™‚ç‹€æ…‹æ›´æ–°

---

## ğŸ¯ ç³»çµ±éœ€æ±‚

### æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

#### 1. ğŸ“… é ç´„ç®¡ç†ä»‹é¢
- **é ç´„è¡¨å–®**: å®¢æˆ¶è³‡è¨Šã€äººæ•¸ã€æ™‚é–“é¸æ“‡
- **æ™‚æ®µæª¢æŸ¥**: ç‡Ÿæ¥­æ™‚é–“é©—è­‰ã€æ¡Œå°å¯ç”¨æ€§
- **è¡çªæª¢æ¸¬**: é‡è¤‡é ç´„é˜²è­·
- **é ç´„ä¿®æ”¹**: æ™‚é–“èª¿æ•´ã€å–æ¶ˆé ç´„

#### 2. ğŸ• æ™‚é–“æ®µç®¡ç†
- **ç‡Ÿæ¥­æ™‚é–“æ•´åˆ**: ä¾æ“šé¤å»³ç‡Ÿæ¥­æ™‚é–“é™åˆ¶
- **æ™‚æ®µåŠƒåˆ†**: 30åˆ†é˜ç‚ºåŸºæœ¬å–®ä½
- **ç·©è¡æ™‚é–“**: 15åˆ†é˜æ¡Œå°ç¿»å°æ™‚é–“
- **é ç´„æœŸé™**: 7å¤©å…§é ç´„é–‹æ”¾

#### 3. ğŸš¥ å®¹é‡æ§åˆ¶æ©Ÿåˆ¶
- **30åˆ†é˜æ¥å¾…ä¸Šé™**: çµ±ä¸€æœ€å¤š8ä½å®¢äººï¼ˆåŒ…å«å¤§æ¡Œï¼‰
- **å…’ç«¥æˆäººå€åˆ†**: è¨˜éŒ„å…’ç«¥èˆ‡æˆäººæ•¸é‡
- **å…’ç«¥æ¤…éœ€æ±‚**: è‡ªå‹•åˆ¤æ–·å…’ç«¥æ¤…é…ç½®éœ€æ±‚
- **æ¡Œå°æ™ºèƒ½åˆ†é…**: åŸºæ–¼ç¸½äººæ•¸å’Œå…’ç«¥éœ€æ±‚

#### 4. ğŸ“± å®¢æˆ¶é«”é©—
- **é ç´„ç¢ºèª**: Email/SMS é€šçŸ¥
- **æé†’æ©Ÿåˆ¶**: é ç´„å‰æé†’
- **åˆ°åº—ç¢ºèª**: QR Code æˆ–é›»è©±ç¢ºèª
- **è©•åƒ¹ç³»çµ±**: é ç´„é«”é©—å›é¥‹

---

## ğŸ—„ï¸ è³‡æ–™åº«çµæ§‹

### ç¾æœ‰çµæ§‹å®Œæ•´æ€§è©•ä¼°

#### âœ… å®Œå…¨æ»¿è¶³éœ€æ±‚çš„è³‡æ–™è¡¨

**`table_reservations` è³‡æ–™è¡¨**
```sql
- id: UUID (ä¸»éµ)
- restaurant_id: UUID (é¤å»³é—œè¯)
- table_id: UUID (æ¡Œå°é—œè¯ï¼Œå¯ç©º)
- customer_name: å®¢æˆ¶å§“å âœ…
- customer_phone: é›»è©±è™Ÿç¢¼ âœ…
- customer_email: Email âœ…
- customer_notes: å®¢æˆ¶å‚™è¨» âœ…
- party_size: ç”¨é¤äººæ•¸ âœ…
- reservation_time: é ç´„æ™‚é–“ âœ…
- duration_minutes: ç”¨é¤æ™‚é•· (é è¨­120åˆ†é˜) âœ…
- estimated_end_time: é ä¼°çµæŸæ™‚é–“ âœ…
- status: ç‹€æ…‹ç®¡ç† âœ…
- special_requests: ç‰¹æ®Šéœ€æ±‚ âœ…
- occasion: å ´åˆ (ç”Ÿæ—¥ã€ç´€å¿µæ—¥) âœ…
- deposit_amount: è¨‚é‡‘é‡‘é¡ âœ…
- deposit_paid: è¨‚é‡‘ç‹€æ…‹ âœ…
- created_at, updated_at: æ™‚é–“æˆ³ âœ…
```

**`tables` è³‡æ–™è¡¨**
```sql
- capacity, min_capacity, max_capacity: å®¹é‡æ§åˆ¶ âœ…
- status: æ¡Œå°ç‹€æ…‹ç®¡ç† âœ…
- current_session_id: æœƒè©±é—œè¯ âœ…
- ai_assignment_priority: æ™ºèƒ½åˆ†é… âœ…
- zone, floor_level: ç©ºé–“ç®¡ç† âœ…
```

#### ğŸ†• éœ€è¦æ–°å¢çš„æ¬„ä½

**`restaurants` è³‡æ–™è¡¨æ“´å±•**
```sql
-- åœ¨ settings JSON ä¸­æ–°å¢é ç´„ç›¸é—œè¨­å®š
{
  "reservation_settings": {
    "max_guests_per_30min": 8,        // 30åˆ†é˜æœ€å¤§æ¥å¾…äººæ•¸ï¼ˆçµ±ä¸€è¦å‰‡ï¼‰
    "default_duration_minutes": 120,   // é è¨­ç”¨é¤æ™‚é•·
    "buffer_minutes": 15,              // æ¡Œå°ç·©è¡æ™‚é–“ï¼ˆç¢ºå®šï¼‰
    "advance_booking_days": 7,         // æå‰é ç´„å¤©æ•¸ï¼ˆ7å¤©å…§ï¼‰
    "deposit_required": false,         // ä¸éœ€è¦è¨‚é‡‘
    "child_chair_available": true,     // å…’ç«¥æ¤…æä¾›
    "reminder_hours": [24, 2]          // æé†’æ™‚é–“é»
  }
}
```

**`table_reservations` è³‡æ–™è¡¨æ“´å±•**
```sql
-- éœ€è¦æ–°å¢çš„æ¬„ä½ä¾†æ”¯æ´å…’ç«¥æˆäººå€åˆ†
ALTER TABLE table_reservations ADD COLUMN IF NOT EXISTS adult_count INTEGER DEFAULT 0;
ALTER TABLE table_reservations ADD COLUMN IF NOT EXISTS child_count INTEGER DEFAULT 0;
ALTER TABLE table_reservations ADD COLUMN IF NOT EXISTS child_chair_needed BOOLEAN DEFAULT false;
```

---

## âš™ï¸ æ¥­å‹™è¦å‰‡

### æ™‚é–“ç®¡ç†è¦å‰‡

#### 1. ç‡Ÿæ¥­æ™‚é–“é™åˆ¶
- é ç´„æ™‚é–“å¿…é ˆåœ¨ç‡Ÿæ¥­æ™‚é–“å…§
- é ä¼°çµæŸæ™‚é–“ä¸å¯è¶…éç‡Ÿæ¥­çµæŸæ™‚é–“
- ä¼‘æ¯æ—¥ä¸æ¥å—é ç´„

#### 2. å®¹é‡æ§åˆ¶è¦å‰‡
```javascript
// 30åˆ†é˜æ™‚æ®µå®¹é‡æª¢æŸ¥
function checkCapacityForTimeSlot(reservationTime, partySize) {
  const timeSlot = getTimeSlot(reservationTime) // å–å¾—30åˆ†é˜æ™‚æ®µ
  const existingReservations = getReservationsInTimeSlot(timeSlot)
  const totalGuests = existingReservations.reduce((sum, res) => sum + res.party_size, 0)
  
  return (totalGuests + partySize) <= 8 // æœ€å¤§å®¹é‡é™åˆ¶
}
```

#### 3. æ¡Œå°åˆ†é…è¦å‰‡
```javascript
// æ™ºèƒ½æ¡Œå°åˆ†é…
function assignTable(partySize, reservationTime) {
  // 1. å®¹é‡åŒ¹é… (æœ€æ¥è¿‘ä½†ä¸å°æ–¼äººæ•¸)
  // 2. å¯ç”¨æ€§æª¢æŸ¥
  // 3. AIå„ªå…ˆç´šæ’åº
  // 4. ç©ºé–“åå¥½ (zone, floor_level)
}
```

#### 4. è¡çªè™•ç†è¦å‰‡
- **ç¡¬è¡çª**: åŒä¸€æ¡Œå°åŒä¸€æ™‚é–“ä¸å¯é‡è¤‡é ç´„
- **è»Ÿè¡çª**: å®¹é‡è¶…é™æ™‚æä¾›å€™ä½æ©Ÿåˆ¶
- **ç·©è¡æ™‚é–“**: æ¡Œå°é–“éš”15åˆ†é˜æ¸…æ½”æ™‚é–“

### ç‹€æ…‹è½‰æ›è¦å‰‡

```mermaid
graph LR
    A[pending] --> B[confirmed]
    B --> C[seated]
    C --> D[completed]
    A --> E[cancelled]
    B --> E
    B --> F[no_show]
```

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### å‰ç«¯çµ„ä»¶æ¶æ§‹

#### 1. é ç´„ç®¡ç†é é¢
```typescript
// ReservationManagementPage.tsx
interface ReservationManagement {
  // é ç´„åˆ—è¡¨é¡¯ç¤º
  reservationList: Reservation[]
  // æ—¥æ›†è¦–åœ–
  calendarView: 'day' | 'week' | 'month'
  // ç¯©é¸åŠŸèƒ½
  filters: ReservationFilters
}
```

#### 2. é ç´„è¡¨å–®çµ„ä»¶
```typescript
// ReservationForm.tsx
interface ReservationForm {
  customerInfo: CustomerInfo
  reservationDetails: ReservationDetails
  timeSlotSelection: TimeSlotPicker
  tablePreference?: TablePreference
}
```

#### 3. æ™‚æ®µé¸æ“‡å™¨
```typescript
// TimeSlotPicker.tsx
interface TimeSlotPicker {
  availableSlots: TimeSlot[]
  selectedDate: Date
  selectedTime: string
  capacityInfo: CapacityInfo
}
```

### å¾Œç«¯æœå‹™æ¶æ§‹

#### 1. é ç´„æœå‹™ (ReservationService)
```typescript
class ReservationService {
  // æª¢æŸ¥å¯ç”¨æ€§
  async checkAvailability(date: Date, partySize: number): Promise<AvailableSlots>
  
  // å‰µå»ºé ç´„
  async createReservation(reservation: CreateReservationRequest): Promise<Reservation>
  
  // æ¡Œå°åˆ†é…
  async assignTable(reservationId: string): Promise<Table>
  
  // å®¹é‡æª¢æŸ¥
  async checkCapacity(timeSlot: TimeSlot): Promise<CapacityStatus>
}
```

#### 2. æ™‚é–“ç®¡ç†æœå‹™ (TimeManagementService)
```typescript
class TimeManagementService {
  // å–å¾—å¯ç”¨æ™‚æ®µ
  async getAvailableTimeSlots(date: Date): Promise<TimeSlot[]>
  
  // ç‡Ÿæ¥­æ™‚é–“æª¢æŸ¥
  async isBusinessHours(datetime: Date): Promise<boolean>
  
  // å®¹é‡è¨ˆç®—
  async calculateCapacityForTimeSlot(timeSlot: TimeSlot): Promise<CapacityInfo>
}
```

---

## ğŸ“ é–‹ç™¼è¨ˆåŠƒ

### Phase 1: åŸºç¤é ç´„åŠŸèƒ½ (é€± 1-2)
- [ ] é ç´„è³‡æ–™è¡¨é©—è­‰èˆ‡å„ªåŒ–
- [ ] åŸºç¤é ç´„ API é–‹ç™¼
- [ ] é ç´„è¡¨å–®çµ„ä»¶é–‹ç™¼
- [ ] æ™‚æ®µé¸æ“‡å™¨é–‹ç™¼

### Phase 2: å®¹é‡ç®¡ç†ç³»çµ± (é€± 3-4)
- [ ] 30åˆ†é˜å®¹é‡é™åˆ¶é‚è¼¯
- [ ] æ™ºèƒ½æ¡Œå°åˆ†é…ç®—æ³•
- [ ] è¡çªæª¢æ¸¬èˆ‡è™•ç†
- [ ] å€™ä½åå–®ç³»çµ±

### Phase 3: ç®¡ç†ä»‹é¢ (é€± 5-6)
- [ ] é ç´„ç®¡ç†é é¢
- [ ] æ—¥æ›†è¦–åœ–çµ„ä»¶
- [ ] é ç´„ç‹€æ…‹ç®¡ç†
- [ ] å ±è¡¨èˆ‡çµ±è¨ˆ

### Phase 4: é€²éšåŠŸèƒ½ (é€± 7-8)
- [ ] é€šçŸ¥ç³»çµ±æ•´åˆ
- [ ] QR Code ç¢ºèª
- [ ] è©•åƒ¹ç³»çµ±
- [ ] æ‰‹æ©ŸéŸ¿æ‡‰å¼å„ªåŒ–

---

## ğŸ§ª æ¸¬è©¦è¦åŠƒ

### å–®å…ƒæ¸¬è©¦
- [ ] å®¹é‡è¨ˆç®—é‚è¼¯æ¸¬è©¦
- [ ] æ™‚æ®µå¯ç”¨æ€§æª¢æŸ¥æ¸¬è©¦
- [ ] æ¡Œå°åˆ†é…ç®—æ³•æ¸¬è©¦
- [ ] ç‹€æ…‹è½‰æ›é‚è¼¯æ¸¬è©¦

### æ•´åˆæ¸¬è©¦
- [ ] é ç´„æµç¨‹ç«¯å°ç«¯æ¸¬è©¦
- [ ] è³‡æ–™åº«äº‹å‹™æ¸¬è©¦
- [ ] API ä»‹é¢æ¸¬è©¦
- [ ] ä½µç™¼é ç´„æ¸¬è©¦

### æ•ˆèƒ½æ¸¬è©¦
- [ ] é«˜ä½µç™¼é ç´„æ¸¬è©¦
- [ ] è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½æ¸¬è©¦
- [ ] å‰ç«¯éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦

---

## ğŸ“Š é æœŸæ•ˆç›Š

### ç‡Ÿé‹æ•ˆç›Š
- **æå‡ç¿»å°ç‡**: æ™ºèƒ½æ™‚æ®µç®¡ç†ï¼Œæœ€ä½³åŒ–æ¡Œå°ä½¿ç”¨ç‡
- **æ¸›å°‘ç©ºç½®**: 30åˆ†é˜å®¹é‡æ§åˆ¶ï¼Œæœ€å¤§åŒ–æ¥å¾…èƒ½åŠ›
- **å®¢æˆ¶æ»¿æ„åº¦**: æ˜ç¢ºé ç´„æµç¨‹ï¼Œæ¸›å°‘ç­‰å¾…æ™‚é–“

### æŠ€è¡“æ•ˆç›Š
- **è³‡æ–™å®Œæ•´æ€§**: å®Œå–„çš„é ç´„è³‡æ–™è¿½è¹¤
- **ç³»çµ±æ•´åˆ**: èˆ‡ç¾æœ‰æ¡Œå°ã€è¨‚å–®ç³»çµ±ç„¡ç¸«æ•´åˆ
- **æ“´å±•æ€§**: æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ”¯æ´æœªä¾†åŠŸèƒ½æ“´å±•

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³å¯åŸ·è¡Œ
1. âœ… **è³‡æ–™åº«çµæ§‹å·²å®Œå‚™** - `table_reservations` è¡¨åŠŸèƒ½å®Œæ•´
2. âœ… **ç‡Ÿæ¥­æ™‚é–“ç³»çµ±å·²å°±ç·’** - `business_hours` è¨­å®šå®Œå–„  
3. âœ… **æ¡Œå°ç®¡ç†ç³»çµ±å·²æ•´åˆ** - æ”¯æ´æ™ºèƒ½åˆ†é…

### éœ€è¦ç¢ºèªçš„é …ç›®
1. **30åˆ†é˜å®¹é‡ä¸Šé™ 8äºº** - æ˜¯å¦é©ç”¨æ–¼æ‰€æœ‰æ™‚æ®µï¼Ÿ
2. **ç·©è¡æ™‚é–“è¨­å®š** - 15åˆ†é˜æ˜¯å¦è¶³å¤ ï¼Ÿ
3. **é ç´„æå‰å¤©æ•¸** - æœ€å¤šæå‰å¤šå°‘å¤©é ç´„ï¼Ÿ
4. **è¨‚é‡‘æ©Ÿåˆ¶** - æ˜¯å¦éœ€è¦ç·šä¸Šæ”¯ä»˜æ•´åˆï¼Ÿ
5. **ç‰¹æ®Šå ´åˆ** - ç”Ÿæ—¥ã€ç´€å¿µæ—¥æ˜¯å¦éœ€è¦ç‰¹åˆ¥è™•ç†ï¼Ÿ

### å»ºè­°å„ªå…ˆé †åº
1. **ğŸ¥‡ é«˜å„ªå…ˆç´š**: åŸºç¤é ç´„åŠŸèƒ½ + å®¹é‡ç®¡ç†
2. **ğŸ¥ˆ ä¸­å„ªå…ˆç´š**: ç®¡ç†ä»‹é¢ + æ™ºèƒ½åˆ†é…  
3. **ğŸ¥‰ ä½å„ªå…ˆç´š**: é€šçŸ¥ç³»çµ± + é€²éšåŠŸèƒ½

---

**ğŸ“‹ æ–‡ä»¶ç‹€æ…‹**: âœ… å®Œæˆè³‡æ–™æ”¶é›†ï¼Œç­‰å¾…ç¢ºèªé–‹å§‹é–‹ç™¼  
**ğŸ“… å»ºç«‹æ—¥æœŸ**: 2025å¹´8æœˆ8æ—¥  
**ğŸ‘¤ è² è²¬äºº**: TanaPOS é–‹ç™¼åœ˜éšŠ  
**ğŸ”„ æœ€å¾Œæ›´æ–°**: 2025å¹´8æœˆ8æ—¥
